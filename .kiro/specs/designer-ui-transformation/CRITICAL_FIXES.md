# 关键问题修复计划

## 问题清单

### 1. 选择框没有包裹住组件 ❌

**原因：** 坐标计算可能不准确，或者 SelectionOverlay 的定位有问题

### 2. 父子组件嵌套时选择框关系混乱 ❌

**原因：** 子组件的选择框应该相对于画布，而不是相对于父组件

### 3. 属性样式配置不生效 ❌

**原因：** handlePropertyUpdate 虽然合并了 styles，但可能没有正确触发更新

### 4. 拖拽调整大小不同步 ❌

**原因：**

- 拖拽调整大小时，组件大小变化有问题
- 应该基于初始位置调整，而不是跳动
- 样式配置面板没有实时更新

### 5. 拖拽到父组件内部渲染问题 ❌

**原因：** 子组件渲染时还保留了父组件的信息

## 修复方案

### 修复 1: 选择框定位

1. 确保 SelectionOverlay 使用 `position: fixed` 而不是 `absolute`
2. 使用视口坐标而不是相对坐标
3. 添加滚动偏移量计算

### 修复 2: 父子组件选择框

1. 所有选择框都相对于画布容器定位
2. 使用 `getBoundingClientRect()` 获取绝对位置
3. 减去画布容器的偏移量

### 修复 3: 属性更新同步

1. 确保 updateControl 正确触发响应式更新
2. 添加强制刷新机制
3. 在属性更新后触发 updateControlRect

### 修复 4: 调整大小同步

1. 修复调整大小的计算逻辑
2. 实时更新样式配置面板
3. 确保选择框同步更新

### 修复 5: 子组件渲染

1. 清理子组件的父组件引用
2. 确保只渲染当前组件内容
3. 正确处理子组件的定位

## 实施步骤

1. 修复 SelectionOverlay 定位方式
2. 修复 updateControlRect 坐标计算
3. 修复 handlePropertyUpdate 同步机制
4. 修复 handleResizeMove 调整逻辑
5. 修复子组件渲染逻辑
