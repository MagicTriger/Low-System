# 资源管理系统需求文档

## 简介

本文档描述了一个完整的资源管理系统，该系统包括三个主要部分：

1. **预览功能修复与美化** - 修复现有的预览功能并提升用户体验
2. **资源管理界面** - 基于菜单管理接口的资源管理表格界面
3. **中后台管理系统** - 新建的管理端系统，用于管理和配置资源

该系统的核心理念是：资源管理界面作为中心枢纽，负责生成设计端和管理端的界面配置，而这两个客户端界面是代码生成的（非设计器生成），与现有项目架构深度集成。

## 需求列表

### 需求 1: 预览功能修复与美化

**用户故事:** 作为设计器用户，我希望预览功能能够正常工作并且界面美观，以便我能够实时查看设计效果。

#### 验收标准

1. WHEN 用户在设计器中点击"预览"按钮 THEN 系统应该正确加载并显示当前设计的页面
2. WHEN 预览页面加载时 THEN 系统应该从 sessionStorage 正确读取设计数据
3. WHEN 预览页面无法加载数据时 THEN 系统应该显示友好的错误提示信息
4. WHEN 用户切换设备类型（桌面/平板/手机）THEN 预览视口应该相应调整尺寸
5. WHEN 用户点击全屏按钮 THEN 预览应该进入全屏模式并正确显示
6. WHEN 用户在预览页面点击"返回编辑"THEN 系统应该返回到设计器页面
7. IF 预览页面存在 THEN 界面应该采用现代化的设计风格，包括合适的颜色、间距和动画效果
8. WHEN 用户在预览模式下 THEN 所有组件应该按照设计器中配置的样式和属性正确渲染

### 需求 2: 资源管理界面开发

**用户故事:** 作为系统管理员，我希望有一个资源管理界面来管理设计端和管理端的页面资源，以便我能够统一配置和管理所有界面。

#### 验收标准

1. WHEN 用户访问资源管理页面 THEN 系统应该显示一个包含所有资源的表格
2. WHEN 表格加载时 THEN 系统应该显示以下字段：id、parentId、menuCode、name、module、nodeType、sortOrder、url、icon、path、meta、createdAt
3. WHEN 用户点击"新建资源"按钮 THEN 系统应该打开一个表单对话框用于创建新资源
4. WHEN 用户提交创建表单 THEN 系统应该调用 `/api/permissions/menus/create` 接口创建资源
5. WHEN 用户点击表格中的"编辑"按钮 THEN 系统应该打开编辑表单并预填充当前资源数据
6. WHEN 用户提交编辑表单 THEN 系统应该调用 `/api/permissions/menus/update` 接口更新资源
7. WHEN 用户点击"删除"按钮 THEN 系统应该显示确认对话框，确认后调用 `/api/permissions/menus/delete/{id}` 接口
8. WHEN 用户使用搜索功能 THEN 系统应该支持按 name、menuCode、module 等字段进行模糊搜索
9. WHEN 用户使用筛选功能 THEN 系统应该支持按 nodeType、parentId 等字段进行精确筛选
10. WHEN 表格数据超过一页 THEN 系统应该提供分页功能，支持切换页码和调整每页显示数量
11. WHEN 用户点击"查看树形结构"按钮 THEN 系统应该调用 `/api/permissions/menus/tree` 接口并以树形视图展示资源层级
12. IF 资源的 nodeType 为 1（文件夹）THEN 该资源应该能够作为其他资源的父级
13. IF 资源的 nodeType 为 2（页面）THEN 该资源应该关联到具体的路由路径
14. IF 资源的 nodeType 为 3（按钮）THEN 该资源应该表示页面内的操作权限
15. WHEN 资源管理界面加载时 THEN 界面应该采用 Ant Design Vue 组件库的现代化设计风格

### 需求 3: 设计端路由集成

**用户故事:** 作为开发者，我希望资源管理系统能够与现有的设计端路由集成，以便用户可以通过资源配置访问设计端的各个页面。

#### 验收标准

1. WHEN 系统初始化时 THEN 应该在设计端路由中添加资源管理页面的路由配置
2. WHEN 用户在设计端导航到资源管理页面 THEN 系统应该正确渲染资源管理界面
3. WHEN 资源管理界面创建或更新资源时 THEN 系统应该能够识别该资源是否属于设计端
4. IF 资源的 module 字段标识为设计端模块 THEN 该资源应该在设计端的导航菜单中显示
5. WHEN 用户点击设计端导航菜单中的资源链接 THEN 系统应该根据资源的 path 字段进行路由跳转
6. WHEN 设计端路由配置更新时 THEN 系统应该保持与现有路由结构的兼容性

### 需求 4: 中后台管理系统创建

**用户故事:** 作为系统架构师，我希望创建一个独立的中后台管理系统，以便管理员可以在专门的管理界面中配置和管理所有资源。

#### 验收标准

1. WHEN 系统启动时 THEN 应该存在一个独立的管理端模块（admin module）
2. WHEN 管理端模块初始化时 THEN 应该配置独立的路由系统
3. WHEN 用户访问管理端根路径 THEN 系统应该显示管理端的登录页面或主页
4. WHEN 管理端加载时 THEN 应该使用与设计端相同的核心基础设施（状态管理、API层、组件库等）
5. WHEN 管理端渲染时 THEN 应该采用典型的中后台布局（侧边栏导航 + 顶部栏 + 内容区 + 底部栏）
6. WHEN 管理端布局组件加载时 THEN 系统布局、LOGO、头部导航、左边栏、底部栏应该通过代码生成（非设计器生成）
7. WHEN 管理端显示 LOGO 时 THEN 应该使用具有高科技感的 LOGO 设计
8. WHEN 用户在管理端导航时 THEN 系统应该根据资源管理界面配置的资源动态生成左侧导航菜单
9. IF 资源的 module 字段标识为管理端模块（如 "admin"）THEN 该资源应该在管理端的左侧导航菜单中显示
10. WHEN 管理端左侧菜单渲染时 THEN 应该调用 `/api/permissions/menus/tree` 接口获取菜单树结构
11. WHEN 管理端菜单树加载时 THEN 应该根据 sortOrder 字段进行排序，根据 nodeType 显示不同的图标
12. WHEN 管理端构建时 THEN 应该生成独立的入口文件（如 admin.html）
13. WHEN 管理端开发时 THEN 应该支持独立的开发服务器配置
14. WHEN 管理端部署时 THEN 应该能够与设计端分离部署或统一部署
15. WHEN 管理端头部导航渲染时 THEN 应该显示用户信息、通知、设置等常用功能入口
16. WHEN 管理端底部栏渲染时 THEN 应该显示版权信息和系统版本号

### 需求 5: 代码生成的客户端界面

**用户故事:** 作为开发者，我希望设计端和管理端的界面是通过代码生成的，而不是通过设计器拖拽生成，以便保持代码的可维护性和与项目架构的一致性。

#### 验收标准

1. WHEN 开发者创建新的设计端页面时 THEN 应该通过编写 Vue 组件代码来实现
2. WHEN 开发者创建新的管理端页面时 THEN 应该通过编写 Vue 组件代码来实现
3. WHEN 资源管理界面配置资源时 THEN 系统应该将资源映射到对应的代码组件
4. IF 资源配置了 path 字段 THEN 该 path 应该对应到一个实际存在的 Vue 组件文件
5. WHEN 系统渲染页面时 THEN 应该通过路由懒加载的方式加载对应的组件
6. WHEN 开发者修改组件代码时 THEN 更改应该立即反映在对应的页面中（热更新）
7. IF 资源的 meta 字段包含组件配置 THEN 系统应该将这些配置传递给组件作为 props
8. WHEN 组件需要访问数据时 THEN 应该使用项目现有的数据层（DataSource、Pipeline等）
9. WHEN 组件需要管理状态时 THEN 应该使用项目现有的状态管理系统（Pinia stores）
10. WHEN 组件需要调用 API 时 THEN 应该使用项目现有的 API 层

### 需求 6: 项目架构集成

**用户故事:** 作为技术负责人，我希望资源管理系统能够与现有项目架构深度集成，以便保持代码的一致性和可维护性。

#### 验收标准

1. WHEN 资源管理系统初始化时 THEN 应该使用项目现有的依赖注入容器（DI Container）
2. WHEN 资源管理系统需要持久化数据时 THEN 应该使用 PersistenceService
3. WHEN 资源管理系统需要调用后端 API 时 THEN 应该使用 src/core/api 中定义的 API 客户端
4. WHEN 资源管理系统需要管理状态时 THEN 应该创建专门的 Pinia store 模块
5. WHEN 资源管理系统需要处理数据时 THEN 应该使用 DataSource 和 Pipeline 系统
6. WHEN 资源管理系统需要渲染组件时 THEN 应该使用 src/core/renderer 中的渲染器组件
7. WHEN 资源管理系统需要显示图标时 THEN 应该使用 IconLibraryManager 和 IconPicker
8. WHEN 资源管理系统需要表单验证时 THEN 应该使用 Ant Design Vue 的表单验证功能
9. WHEN 资源管理系统需要显示通知时 THEN 应该使用 Ant Design Vue 的 message 和 notification 组件
10. WHEN 资源管理系统构建时 THEN 应该遵循项目现有的构建配置（vite.config.ts）
11. IF 资源管理系统需要新的服务 THEN 应该在 src/core/services 中创建并注册到 DI 容器
12. IF 资源管理系统需要新的类型定义 THEN 应该在 src/types 中定义 TypeScript 接口

### 需求 7: 菜单管理 API 集成

**用户故事:** 作为后端开发者，我希望前端能够正确调用菜单管理 API，以便实现资源的增删改查功能。

#### 验收标准

1. WHEN 系统需要查询资源列表时 THEN 应该调用 `GET /api/permissions/menus/list` 接口
2. WHEN 系统需要获取资源树时 THEN 应该调用 `GET /api/permissions/menus/tree` 接口
3. WHEN 系统需要创建资源时 THEN 应该调用 `POST /api/permissions/menus/create` 接口
4. WHEN 系统需要更新资源时 THEN 应该调用 `PUT /api/permissions/menus/update` 接口
5. WHEN 系统需要删除资源时 THEN 应该调用 `DELETE /api/permissions/menus/delete/{id}` 接口
6. WHEN API 调用成功时 THEN 系统应该根据响应的 success 字段判断操作是否成功
7. WHEN API 调用失败时 THEN 系统应该显示响应中的 message 字段作为错误提示
8. WHEN API 返回分页数据时 THEN 系统应该正确解析 data、total、page、size 等分页信息
9. WHEN API 返回树形数据时 THEN 系统应该正确解析 children 字段构建树形结构
10. WHEN 发送 API 请求时 THEN 应该在请求头中携带 Authorization token
11. IF API 返回 401 错误 THEN 系统应该跳转到登录页面
12. IF API 返回 403 错误 THEN 系统应该显示权限不足的提示

### 需求 8: 用户体验优化

**用户故事:** 作为最终用户，我希望资源管理系统具有良好的用户体验，以便我能够高效地完成资源管理任务。

#### 验收标准

1. WHEN 用户执行任何操作时 THEN 系统应该提供即时的视觉反馈（加载状态、成功/失败提示）
2. WHEN 表格数据加载时 THEN 应该显示骨架屏或加载动画
3. WHEN 用户提交表单时 THEN 按钮应该显示加载状态并禁用重复提交
4. WHEN 操作成功时 THEN 系统应该显示成功提示消息（绿色）
5. WHEN 操作失败时 THEN 系统应该显示错误提示消息（红色）并说明失败原因
6. WHEN 用户进行危险操作（如删除）时 THEN 系统应该显示确认对话框
7. WHEN 表单验证失败时 THEN 系统应该高亮显示错误字段并显示错误信息
8. WHEN 用户输入数据时 THEN 系统应该提供实时验证反馈
9. WHEN 页面内容较多时 THEN 系统应该提供合理的滚动和分页机制
10. WHEN 用户使用键盘导航时 THEN 系统应该支持常用的键盘快捷键（如 Enter 提交、Esc 取消）
11. IF 用户在移动设备上访问 THEN 界面应该具有响应式设计，适配不同屏幕尺寸
12. IF 用户网络较慢 THEN 系统应该提供合理的超时处理和重试机制

### 需求 9: 权限和安全

**用户故事:** 作为安全管理员，我希望资源管理系统具有完善的权限控制和安全机制，以便保护系统资源不被未授权访问。

#### 验收标准

1. WHEN 用户访问资源管理页面时 THEN 系统应该验证用户是否已登录
2. WHEN 用户执行资源操作时 THEN 系统应该验证用户是否具有相应权限
3. WHEN 用户会话过期时 THEN 系统应该自动跳转到登录页面
4. WHEN 用户尝试访问无权限的资源时 THEN 系统应该显示权限不足的提示
5. WHEN 系统发送 API 请求时 THEN 应该使用 HTTPS 协议（生产环境）
6. WHEN 系统存储敏感数据时 THEN 应该进行适当的加密处理
7. IF 用户输入包含特殊字符 THEN 系统应该进行适当的转义以防止 XSS 攻击
8. IF API 接口接收用户输入 THEN 后端应该进行参数验证和清理
9. WHEN 用户登出时 THEN 系统应该清除所有本地存储的认证信息
10. WHEN 系统检测到异常访问时 THEN 应该记录日志并触发安全警报

### 需求 10: 可维护性和扩展性

**用户故事:** 作为开发团队成员，我希望资源管理系统具有良好的代码结构和文档，以便后续维护和功能扩展。

#### 验收标准

1. WHEN 开发者查看代码时 THEN 应该有清晰的目录结构和文件组织
2. WHEN 开发者阅读代码时 THEN 关键函数和组件应该有详细的注释说明
3. WHEN 开发者需要添加新功能时 THEN 应该能够通过扩展现有接口而不是修改核心代码
4. WHEN 开发者需要修改 API 接口时 THEN 应该有统一的 API 客户端封装
5. WHEN 开发者需要添加新的资源类型时 THEN 应该能够通过配置而不是硬编码
6. WHEN 开发者需要调试问题时 THEN 系统应该提供详细的日志输出
7. IF 系统出现错误 THEN 应该有完善的错误处理和错误边界
8. IF 需要国际化支持 THEN 系统应该预留 i18n 集成点
9. WHEN 代码提交时 THEN 应该通过 ESLint 和 TypeScript 类型检查
10. WHEN 项目构建时 THEN 应该生成清晰的构建报告和性能指标
11. WHEN 开发者需要测试功能时 THEN 应该提供单元测试和集成测试的基础设施
12. WHEN 系统版本更新时 THEN 应该有清晰的版本管理和迁移指南
