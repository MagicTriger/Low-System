# 管理端侧边栏简化需求

## 概述

简化管理端(admin)的侧边栏,去除搜索、筛选等复杂功能,只保留简洁的菜单列表,显示从设计端资源管理界面挂载过来的菜单项。

## 核心目标

- 简化侧边栏界面,只显示菜单列表
- 支持从设计端挂载菜单到管理端
- 保持与现有 DynamicMenu 组件的兼容性
- 提供清晰的菜单层级展示

## 用户故事

### 1. 简洁的侧边栏布局

**用户故事**: 作为管理员,我希望有一个简洁的侧边栏,只显示已挂载的菜单项,不需要搜索和筛选功能。

**验收标准**:

1. WHEN 管理员打开管理端 THEN 侧边栏应只显示 Logo 和菜单列表
2. WHEN 管理员查看侧边栏 THEN 不应显示搜索框和筛选器
3. WHEN 管理员查看侧边栏 THEN 应以树形结构显示菜单
4. WHEN 侧边栏折叠 THEN 应只显示菜单图标

### 2. 菜单挂载功能

**用户故事**: 作为管理员,我希望在设计端资源管理界面标记的菜单能够自动显示在管理端侧边栏。

**验收标准**:

1. WHEN 管理员在设计端标记菜单为"挂载到管理端" THEN 该菜单应出现在管理端侧边栏
2. WHEN 管理员在设计端取消挂载 THEN 管理端侧边栏应移除该菜单
3. WHEN 管理员在设计端修改已挂载菜单 THEN 管理端侧边栏应自动更新
4. WHEN 没有挂载任何菜单 THEN 应显示默认菜单(仪表板、资源管理)

### 3. 树形菜单展示

**用户故事**: 作为管理员,我希望侧边栏以树形结构展示菜单层级,支持展开/折叠。

**验收标准**:

1. WHEN 管理员查看侧边栏 THEN 应显示完整的菜单树形结构
2. WHEN 管理员点击文件夹节点 THEN 应展开/折叠子菜单
3. WHEN 管理员点击页面节点 THEN 应导航到对应页面
4. WHEN 管理员查看节点 THEN 应显示对应的图标和名称
5. WHEN 菜单节点是按钮类型(nodeType=3) THEN 不应在侧边栏显示

### 4. 菜单导航

**用户故事**: 作为管理员,我希望点击菜单项能够导航到对应页面,并高亮当前页面。

**验收标准**:

1. WHEN 管理员点击页面类型菜单 THEN 应导航到对应路由
2. WHEN 页面加载完成 THEN 当前菜单项应高亮显示
3. WHEN 管理员刷新页面 THEN 应保持当前菜单项的高亮状态
4. WHEN 菜单项没有配置路由 THEN 点击应显示提示信息

### 5. 响应式设计

**用户故事**: 作为管理员,我希望侧边栏在不同设备上都能正常使用。

**验收标准**:

1. WHEN 管理员在桌面端使用 THEN 侧边栏默认展开,宽度 220px
2. WHEN 管理员折叠侧边栏 THEN 宽度变为 80px
3. WHEN 管理员在移动端使用 THEN 侧边栏应适配小屏幕
4. WHEN 屏幕宽度 < 768px THEN 内容区应自动调整边距

## 非功能需求

### 性能要求

- 菜单树加载时间 < 200ms (100个菜单项)
- 菜单展开/折叠动画流畅(60fps)
- 页面导航响应时间 < 100ms

### 兼容性要求

- 支持 Chrome、Firefox、Safari、Edge 最新版本
- 支持移动端浏览器
- 支持触摸操作

### 可访问性要求

- 支持键盘导航
- 菜单项有清晰的焦点状态

## 技术约束

1. 复用现有的 DynamicMenu 组件
2. 使用现有的 resource state 模块
3. 保持与现有 API 的兼容性
4. 菜单数据通过 API 获取

## 边界条件

### 包含

- 简洁的侧边栏布局(只有 Logo 和菜单)
- 菜单树形展示
- 菜单导航功能
- 菜单挂载机制
- 响应式设计

### 不包含

- 搜索功能(已删除)
- 筛选功能(已删除)
- 统计信息(已删除)
- 菜单编辑功能(在设计端完成)
- 菜单权限管理(已有功能)

### 数据规则

- 只显示 nodeType 为 1(文件夹)和 2(页面)的菜单项
- 按钮类型(nodeType=3)不在侧边栏显示
- 菜单树最大深度为 3 层
- 菜单按 sortOrder 字段排序

## 依赖关系

### 前置条件

- DynamicMenu 组件已实现
- resource state 模块已实现
- 菜单 API 已实现

### 依赖组件

- DynamicMenu (src/modules/admin/components/DynamicMenu.vue)
- resource state module (src/core/state/modules/resource.ts)
- menu API (src/core/api/menu.ts)

## 实现方案

### 方案概述

保持现有的 DynamicMenu 组件不变,只需要:

1. 在设计端资源管理界面添加"挂载到管理端"操作
2. 在菜单数据中添加 `mountedToAdmin` 字段标识是否挂载
3. 管理端加载菜单时只获取已挂载的菜单
4. 删除之前创建的 AdminSidebar、SidebarSearch、SidebarFilter 组件

### API 调整

需要在菜单 API 中添加:

```typescript
// 获取已挂载到管理端的菜单树
getAdminMenuTree(): Promise<MenuTreeNode[]>

// 标记菜单挂载到管理端
mountMenuToAdmin(menuCode: string): Promise<void>

// 取消菜单挂载
unmountMenuFromAdmin(menuCode: string): Promise<void>
```

### 数据结构

MenuTreeNode 添加字段:

```typescript
interface MenuTreeNode {
  // ... 现有字段
  mountedToAdmin?: boolean // 是否挂载到管理端
}
```

## 风险和挑战

### 技术风险

1. **数据同步**: 设计端和管理端的菜单状态需要保持同步
2. **默认菜单**: 没有挂载菜单时需要显示默认菜单

### 解决方案

1. 使用统一的 API 获取菜单数据,确保数据一致性
2. 在 DynamicMenu 组件中添加默认菜单逻辑

## 成功标准

1. 管理端侧边栏只显示 Logo 和菜单列表
2. 设计端标记的菜单能自动显示在管理端
3. 菜单导航功能正常
4. 性能指标达标
5. 代码简洁,易于维护
