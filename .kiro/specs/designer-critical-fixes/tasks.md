# 实现计划

- [x] 1. 修复 DesignerControlRenderer 无限循环问题

  - 移除所有可能触发 DOM 变化的 console.log 语句
  - 添加防抖机制到 updateControlRect 函数
  - 优化 MutationObserver 配置，只监听必要的属性变化
  - 优化 watch 监听，移除 deep: true，只监听特定属性
  - 添加循环检测机制，防止意外的无限循环
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 2. 创建数据源配置模态框组件

  - [x] 2.1 创建 DataSourceConfigModal 主组件

    - 创建全屏模态框布局（使用 Ant Design Modal）
    - 实现左侧 Tabs 导航（数据源、数据流、数据操作）
    - 实现右侧预览面板
    - 实现底部操作栏（保存、取消、导入、导出）
    - _Requirements: 2.1, 2.2, 2.8_

  - [ ] 2.2 创建 DataSourcePanel 数据源配置面板

    - 实现数据源列表显示
    - 实现添加数据源功能
    - 实现编辑数据源功能
    - 实现删除数据源功能
    - 实现数据源类型选择（API、静态、Mock）
    - 实现 API 类型配置表单（URL、方法、参数、请求头）
    - 实现静态数据配置（JSON 编辑器）
    - 实现 Mock 数据配置（模板编辑器）
    - 实现字段元数据配置
    - 实现测试连接功能

    - _Requirements: 2.3, 2.4_

  - [ ] 2.3 创建 DataFlowPanel 数据流配置面板

    - 实现数据流列表显示
    - 实现添加数据流功能

    - 实现数据源选择
    - 实现数据转换配置（过滤、映射、聚合、排序）
    - 实现可视化数据流图
    - _Requirements: 2.5_

  - [x] 2.4 创建 DataOperationPanel 数据操作配置面板

    - 实现数据操作列表显示
    - 实现添加操作功能
    - 实现 CRUD 操作类型选择
    - 实现操作参数配置
    - 实现操作前后钩子配置
    - 实现操作权限控制配置
    - _Requirements: 2.6_

  - [ ] 2.5 创建 DataPreview 预览组件
    - 实现数据源预览（显示数据结构和示例数据）
    - 实现数据流预览（显示转换后的数据）
    - 实现操作预览（显示操作配置）
    - _Requirements: 2.9_

- [ ] 3. 集成数据源配置到设计器状态

  - [ ] 3.1 扩展 DesignerState 类型定义

    - 添加 dataConfig 字段到状态类型
    - 定义 DataSourceConfig 接口

    - 定义 DataFlowConfig 接口

    - 定义 DataOperationConfig 接口
    - _Requirements: 2.8_

  - [ ] 3.2 实现数据配置状态管理
    - 在 useDesignerState 中添加数据配置状态
    - 实现添加数据源方法
    - 实现更新数据源方法
    - 实现删除数据源方法
    - 实现数据配置的保存和加载
    - _Requirements: 2.8_
  - [ ] 3.3 连接工具栏按钮到配置弹框
    - 在 DesignerNew.vue 中添加弹框状态
    - 实现打开弹框的处理函数
    - 实现保存配置的处理函数
    - 实现取消的处理函数
    - 传递数据配置状态到弹框组件
    - _Requirements: 2.1, 2.8_

- [ ] 4. 实现数据源配置验证和测试

  - [ ] 4.1 实现配置验证逻辑
    - 创建 validateDataSourceConfig 函数
    - 验证必填字段
    - 验证 URL 格式
    - 验证 JSON 格式
    - 显示验证错误提示
    - _Requirements: 2.7_
  - [ ] 4.2 实现数据源连接测试
    - 创建 testDataSource 函数
    - 实现 API 类型测试（发送实际请求）
    - 实现静态数据验证
    - 实现 Mock 数据生成测试
    - 显示测试结果（成功/失败/数据预览）
    - _Requirements: 2.4_

- [ ] 5. 实现配置的导入导出功能

  - [ ] 5.1 实现配置导出
    - 创建导出函数，将配置转换为 JSON
    - 实现文件下载功能
    - 添加导出按钮点击处理
    - _Requirements: 2.8_
  - [ ] 5.2 实现配置导入
    - 创建文件选择器
    - 实现 JSON 文件解析
    - 验证导入的配置格式
    - 合并导入的配置到现有配置
    - 显示导入结果提示
    - _Requirements: 2.8_

- [ ] 6. 优化性能和用户体验

  - [ ] 6.1 添加加载状态
    - 在测试连接时显示加载动画
    - 在保存配置时显示加载动画
    - 在导入配置时显示加载动画
    - _Requirements: 2.7_
  - [ ] 6.2 添加错误处理
    - 捕获网络请求错误
    - 捕获 JSON 解析错误
    - 显示友好的错误提示
    - 提供错误恢复建议
    - _Requirements: 2.7_
  - [ ] 6.3 优化大数据量处理
    - 使用虚拟滚动显示大量数据源
    - 使用防抖优化搜索和过滤
    - 使用懒加载加载配置面板
    - _Requirements: 2.3_

- [ ]\* 7. 编写测试用例

  - [ ]\* 7.1 编写 DesignerControlRenderer 单元测试
    - 测试无限循环修复
    - 测试防抖功能
    - 测试 MutationObserver 优化
    - 测试循环检测机制
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_
  - [ ]\* 7.2 编写数据源配置组件单元测试
    - 测试数据源添加功能
    - 测试数据源编辑功能
    - 测试数据源删除功能
    - 测试配置验证功能
    - 测试连接测试功能
    - _Requirements: 2.3, 2.4, 2.7_
  - [ ]\* 7.3 编写集成测试
    - 测试大屏组件拖拽不崩溃
    - 测试数据源配置保存和加载
    - 测试配置导入导出
    - _Requirements: 1.1, 2.8_

- [ ] 8. 更新文档和示例

  - [ ] 8.1 更新用户文档
    - 编写数据源配置使用指南
    - 添加配置示例
    - 添加常见问题解答
    - _Requirements: 2.1, 2.3, 2.5, 2.6_
  - [ ] 8.2 创建示例配置
    - 创建 API 数据源示例
    - 创建静态数据源示例
    - 创建 Mock 数据源示例
    - 创建数据流示例
    - 创建数据操作示例
    - _Requirements: 2.4, 2.5, 2.6_
