var Ue=Object.defineProperty;var je=(T,t,i)=>t in T?Ue(T,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):T[t]=i;var O=(T,t,i)=>je(T,typeof t!="symbol"?t+"":t,i);import{d as me,h as b,r as G,f as R,o as he,D as Ae,b as pe,w as He,bo as h,bp as p,bq as _,bE as e,bz as L,V as se,bF as u,F as C,bs as x,by as q,bZ as le,I as de,bW as ue,z as Ne,u as Je}from"./vendor.BT0Of-np.js";import{_ as ve}from"./index.MMW6Q6l4.js";import"./antdv.B3VvJiRs.js";const We={class:"monitor-header"},qe={class:"header-left"},Ke={class:"header-right"},Ve={class:"metrics-grid"},Ge={class:"metric-header"},Ze={class:"metric-name"},Qe={class:"metric-value"},Xe={class:"metric-chart"},Ye=["points","stroke"],et={class:"analysis-tabs"},tt={class:"tab-headers"},st=["onClick"],ot={class:"tab-content"},it={key:0,class:"memory-analysis"},nt={class:"memory-overview"},at={class:"memory-usage"},rt={class:"usage-bar"},ct={class:"usage-text"},lt={class:"memory-breakdown"},dt={class:"item-name"},ut={class:"item-value"},mt={class:"item-bar"},ht={key:1,class:"render-analysis"},pt={class:"render-metrics"},vt={class:"metric-group"},ft={class:"fps-chart"},yt={class:"metric-group"},gt={class:"render-times"},_t={class:"time-name"},wt={class:"time-value"},bt={class:"time-bar"},kt={key:2,class:"network-analysis"},St={class:"network-overview"},Mt={class:"network-stats"},$t={class:"stat-item"},zt={class:"stat-value"},Ct={class:"stat-item"},xt={class:"stat-value"},Tt={class:"stat-item"},Et={class:"stat-value"},Ot={class:"stat-item"},Pt={class:"stat-value"},Rt={class:"network-requests"},Lt={class:"request-list"},Ft=["title"],Dt={class:"col-time"},Bt={class:"col-size"},It={key:3,class:"cache-analysis"},Ut={class:"cache-overview"},jt={class:"cache-stats"},At={class:"stat-card"},Ht={class:"stat-value"},Nt={class:"stat-chart"},Jt={class:"hit-rate-circle"},Wt={width:"60",height:"60",viewBox:"0 0 60 60"},qt=["stroke-dashoffset"],Kt={class:"stat-card"},Vt={class:"stat-value"},Gt={class:"stat-subtitle"},Zt={class:"stat-card"},Qt={class:"stat-value"},Xt={class:"stat-subtitle"},Yt={class:"cache-layers"},es={class:"layer-header"},ts={class:"layer-name"},ss={class:"layer-size"},os={class:"layer-bar"},is={class:"layer-stats"},ns={key:4,class:"error-analysis"},as={class:"error-overview"},rs={class:"error-stats"},cs={class:"error-count"},ls={class:"count-number"},ds={class:"error-rate"},us={class:"rate-number"},ms={class:"error-list"},hs={class:"error-filters"},ps={class:"error-items"},vs={class:"error-header"},fs={class:"error-type"},ys={class:"error-time"},gs={key:0,class:"error-count"},_s={class:"error-message"},ws={key:0,class:"error-stack"},bs={class:"error-actions"},ks=["onClick"],Ss=["onClick"],Ms=["onClick"],$s={key:0,class:"performance-suggestions"},zs={class:"suggestion-list"},Cs={class:"suggestion-icon"},xs={class:"suggestion-content"},Ts={class:"suggestion-title"},Es={class:"suggestion-description"},Os={class:"suggestion-impact"},Ps={class:"suggestion-actions"},Rs=["onClick"],Ls=["onClick"],Fs=100,Ds=30,Bs=me({__name:"PerformanceMonitor",props:{isDark:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},autoStart:{type:Boolean,default:!0},updateInterval:{default:1e3},maxHistorySize:{default:100}},emits:["performance-alert","metric-threshold","error-detected"],setup(T,{emit:t}){const i=T,r=t,d=b(!1),a=b("memory"),l=b("all"),f=b("time"),z=b(!1),w=b([{key:"fps",name:"FPS",value:60,unit:"fps",trend:"stable",history:[],threshold:30},{key:"memory",name:"内存使用",value:0,unit:"MB",trend:"stable",history:[]},{key:"cpu",name:"CPU 使用",value:0,unit:"%",trend:"stable",history:[]},{key:"network",name:"网络延迟",value:0,unit:"ms",trend:"stable",history:[]}]),g=G({used:0,total:0,available:0,heap:0,nonHeap:0}),M=G({totalRequests:0,successRate:100,averageLatency:0,totalBytes:0}),k=G({hitRate:0,totalSize:0,totalEntries:0,memoryUsage:0,memoryUsed:0}),D=G({totalErrors:0,errorRate:0}),B=b([]),S=b([]),$=b([]),J=R(()=>{const s=w.value.find(o=>o.key==="fps"),n=w.value.find(o=>o.key==="memory");return s&&s.value<30?"critical":n&&n.value>80||D.errorRate>5?"warning":"good"}),Z=R(()=>{switch(J.value){case"good":return"良好";case"warning":return"警告";case"critical":return"严重";default:return"未知"}}),F=R(()=>g.total>0?g.used/g.total*100:0),Q=R(()=>[{name:"堆内存",value:g.heap,color:"#3b82f6"},{name:"非堆内存",value:g.nonHeap,color:"#10b981"},{name:"可用内存",value:g.available,color:"#f59e0b"}]),K=b([{name:"组件渲染",value:0},{name:"样式计算",value:0},{name:"布局计算",value:0},{name:"绘制时间",value:0}]),X=R(()=>Math.max(...K.value.map(s=>s.value),1)),V=R(()=>[{name:"内存缓存",size:150,hits:1200,misses:50,evictions:10,color:"#3b82f6"},{name:"会话缓存",size:80,hits:800,misses:30,evictions:5,color:"#10b981"},{name:"本地缓存",size:40,hits:400,misses:20,evictions:2,color:"#f59e0b"},{name:"索引缓存",size:20,hits:200,misses:10,evictions:1,color:"#ef4444"}]),Y=R(()=>Math.max(...V.value.map(s=>s.size),1)),W=2*Math.PI*25,ee=R(()=>{let s=S.value;switch(l.value!=="all"&&(s=s.filter(n=>n.type===l.value)),f.value){case"frequency":s.sort((o,y)=>y.count-o.count);break;case"severity":const n={critical:4,high:3,medium:2,low:1};s.sort((o,y)=>n[y.severity]-n[o.severity]);break;default:s.sort((o,y)=>y.timestamp-o.timestamp)}return s}),te=[{key:"memory",name:"内存",icon:"icon-memory"},{key:"render",name:"渲染",icon:"icon-render"},{key:"network",name:"网络",icon:"icon-network"},{key:"cache",name:"缓存",icon:"icon-cache"},{key:"errors",name:"错误",icon:"icon-error"}];let H=null,v=null,c=null;const m=()=>{d.value?P():E()},E=()=>{d.value=!0,H=window.setInterval(()=>{I()},i.updateInterval),window.PerformanceObserver&&(v=new PerformanceObserver(s=>{const n=s.getEntries();we(n)}),v.observe({entryTypes:["measure","navigation","resource","paint"]})),window.addEventListener("error",ie),window.addEventListener("unhandledrejection",ne)},P=()=>{d.value=!1,H&&(clearInterval(H),H=null),v&&(v.disconnect(),v=null),window.removeEventListener("error",ie),window.removeEventListener("unhandledrejection",ne)},I=()=>{if(performance.memory){const s=performance.memory;g.used=s.usedJSHeapSize,g.total=s.totalJSHeapSize,g.available=s.jsHeapSizeLimit-s.usedJSHeapSize,g.heap=s.usedJSHeapSize,g.nonHeap=s.totalJSHeapSize-s.usedJSHeapSize;const n=w.value.find(o=>o.key==="memory");if(n){const o=s.usedJSHeapSize/1048576;oe(n,o)}}fe(),ge(),_e(),ke(),Se()},oe=(s,n)=>{if(s.value=n,s.history.push(n),s.history.length>i.maxHistorySize&&s.history.shift(),s.history.length>=3){const o=s.history.slice(-3),y=o.reduce((A,N)=>A+N,0)/o.length,U=s.history[s.history.length-4]||y;y>U*1.1?s.trend="up":y<U*.9?s.trend="down":s.trend="stable"}},fe=()=>{const s=performance.now(),n=Math.round(1e3/(s-window.lastFrameTime||16));window.lastFrameTime=s;const o=w.value.find(y=>y.key==="fps");o&&oe(o,Math.min(n,60)),ye()},ye=()=>{if(!c)return;const s=c.getContext("2d");if(!s)return;const n=w.value.find(A=>A.key==="fps");if(!n||n.history.length===0)return;s.clearRect(0,0,c.width,c.height);const o=c.width,y=c.height,U=n.history.slice(-50);U.length<2||(s.strokeStyle="#3b82f6",s.lineWidth=2,s.beginPath(),U.forEach((A,N)=>{const re=N/(U.length-1)*o,ce=y-A/60*y;N===0?s.moveTo(re,ce):s.lineTo(re,ce)}),s.stroke())},ge=()=>{M.totalRequests+=Math.floor(Math.random()*5),M.successRate=95+Math.random()*5,M.averageLatency=50+Math.random()*100,M.totalBytes+=Math.floor(Math.random()*1e4)},_e=()=>{k.hitRate=80+Math.random()*20,k.totalSize=1024*1024*(10+Math.random()*40),k.totalEntries=100+Math.floor(Math.random()*900),k.memoryUsage=.3+Math.random()*.4,k.memoryUsed=k.totalSize*k.memoryUsage},we=s=>{s.forEach(n=>{if(n.entryType==="resource"){const o=n;be({id:Math.random().toString(36).substr(2,9),method:"GET",url:o.name,status:200,duration:o.duration,size:o.transferSize||0,timestamp:o.startTime})}})},be=s=>{B.value.unshift(s),B.value.length>100&&B.value.pop()},ie=s=>{var o;const n={id:Math.random().toString(36).substr(2,9),type:"javascript",message:s.message,stack:(o=s.error)==null?void 0:o.stack,timestamp:Date.now(),count:1,severity:"medium"};ae(n)},ne=s=>{var o,y;const n={id:Math.random().toString(36).substr(2,9),type:"promise",message:((o=s.reason)==null?void 0:o.message)||"Unhandled promise rejection",stack:(y=s.reason)==null?void 0:y.stack,timestamp:Date.now(),count:1,severity:"high"};ae(n)},ae=s=>{const n=S.value.find(o=>o.message===s.message&&o.type===s.type);n?(n.count++,n.timestamp=s.timestamp):(S.value.unshift(s),S.value.length>100&&S.value.pop()),D.totalErrors++,r("error-detected",s)},ke=()=>{w.value.forEach(s=>{if(s.threshold&&s.value<s.threshold){const n={type:"threshold",message:`${s.name} 低于阈值: ${s.value}${s.unit} < ${s.threshold}${s.unit}`,severity:"warning",timestamp:Date.now()};r("performance-alert",n),r("metric-threshold",s.key,s.value)}})},Se=()=>{const s=[];F.value>80&&s.push({id:"memory-high",type:"memory",title:"内存使用过高",description:"当前内存使用超过80%，建议清理不必要的对象引用",impact:"减少内存使用20-30%",priority:"high"});const n=w.value.find(o=>o.key==="fps");n&&n.value<30&&s.push({id:"fps-low",type:"render",title:"FPS 过低",description:"帧率低于30fps，建议优化渲染性能",impact:"提升帧率至60fps",priority:"high"}),k.hitRate<70&&s.push({id:"cache-low",type:"cache",title:"缓存命中率低",description:"缓存命中率低于70%，建议优化缓存策略",impact:"提升响应速度30-50%",priority:"medium"}),$.value=s},Me=()=>{w.value.forEach(s=>{s.history=[],s.value=0}),B.value=[],S.value=[],$.value=[],Object.assign(g,{used:0,total:0,available:0,heap:0,nonHeap:0}),Object.assign(M,{totalRequests:0,successRate:100,averageLatency:0,totalBytes:0}),Object.assign(D,{totalErrors:0,errorRate:0})},$e=()=>{const s={timestamp:Date.now(),metrics:w.value,memory:g,network:M,cache:k,errors:D,requests:B.value,errorList:S.value,suggestions:$.value},n=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),y=document.createElement("a");y.href=o,y.download=`performance-report-${new Date().toISOString().slice(0,19)}.json`,y.click(),URL.revokeObjectURL(o)},ze=s=>{s.action&&s.action();const n=$.value.findIndex(o=>o.id===s.id);n>-1&&$.value.splice(n,1)},Ce=s=>{const n=$.value.findIndex(o=>o.id===s);n>-1&&$.value.splice(n,1)},xe=s=>{z.value=!z.value},Te=s=>{const n=S.value.findIndex(o=>o.id===s);n>-1&&S.value.splice(n,1)},Ee=s=>{console.log("Reporting error:",s)},Oe=(s,n)=>n==="MB"?(s/(1024*1024)).toFixed(1)+n:n==="ms"?s.toFixed(0)+n:n==="%"?s.toFixed(1)+n:s.toFixed(0)+n,j=s=>{if(s===0)return"0 B";const n=1024,o=["B","KB","MB","GB"],y=Math.floor(Math.log(s)/Math.log(n));return parseFloat((s/Math.pow(n,y)).toFixed(1))+" "+o[y]},Pe=s=>new Date(s).toLocaleTimeString(),Re=s=>{switch(s){case"up":return"icon-trend-up";case"down":return"icon-trend-down";default:return"icon-trend-stable"}},Le=s=>({fps:"#3b82f6",memory:"#10b981",cpu:"#f59e0b",network:"#ef4444"})[s]||"#6b7280",Fe=s=>{if(s.length===0)return"";const n=Math.max(...s,1);return s.map((y,U)=>{const A=U/(s.length-1)*100,N=30-y/n*30;return`${A},${N}`}).join(" ")},De=s=>s.length<=50?s:s.substring(0,47)+"...",Be=s=>s>=200&&s<300?"success":s>=300&&s<400?"redirect":s>=400&&s<500?"client-error":s>=500?"server-error":"",Ie=s=>({memory:"icon-memory",render:"icon-render",cache:"icon-cache",network:"icon-network"})[s]||"icon-suggestion";return he(()=>{i.autoStart&&E(),Ae(()=>{c=document.querySelector(".fps-chart canvas")})}),pe(()=>{P()}),He(()=>i.updateInterval,s=>{d.value&&(P(),E())}),(s,n)=>(p(),h("div",{class:_(["performance-monitor",{dark:s.isDark,compact:s.compact}])},[e("div",We,[e("div",qe,[n[3]||(n[3]=e("h3",{class:"monitor-title"},[e("i",{class:"icon-monitor"}),se(" 性能监控 ")],-1)),e("div",{class:_(["monitor-status",J.value])},[n[2]||(n[2]=e("span",{class:"status-dot"},null,-1)),se(" "+u(Z.value),1)],2)]),e("div",Ke,[e("button",{class:_(["btn-toggle",{active:d.value}]),onClick:m},u(d.value?"停止":"开始"),3),e("button",{class:"btn-clear",onClick:Me}," 清除数据 "),e("button",{class:"btn-export",onClick:$e}," 导出报告 ")])]),e("div",Ve,[(p(!0),h(C,null,x(w.value,o=>(p(),h("div",{class:"metric-card",key:o.key},[e("div",Ge,[e("span",Ze,u(o.name),1),e("span",{class:_(["metric-trend",o.trend])},[e("i",{class:_(Re(o.trend))},null,2)],2)]),e("div",Qe,u(Oe(o.value,o.unit)),1),e("div",Xe,[(p(),h("svg",{width:Fs,height:Ds,viewBox:"0 0 100 30"},[e("polyline",{points:Fe(o.history),fill:"none",stroke:Le(o.key),"stroke-width":"2"},null,8,Ye)]))])]))),128))]),e("div",et,[e("div",tt,[(p(),h(C,null,x(te,o=>e("button",{key:o.key,class:_(["tab-header",{active:a.value===o.key}]),onClick:y=>a.value=o.key},[e("i",{class:_(o.icon)},null,2),se(" "+u(o.name),1)],10,st)),64))]),e("div",ot,[a.value==="memory"?(p(),h("div",it,[e("div",nt,[e("div",at,[e("div",rt,[e("div",{class:"usage-fill",style:q({width:F.value+"%"})},null,4)]),e("div",ct,u(j(g.used))+" / "+u(j(g.total))+" ("+u(F.value.toFixed(1))+"%) ",1)])]),e("div",lt,[(p(!0),h(C,null,x(Q.value,o=>(p(),h("div",{class:"breakdown-item",key:o.name},[e("div",dt,u(o.name),1),e("div",ut,u(j(o.value)),1),e("div",mt,[e("div",{class:"item-fill",style:q({width:o.value/g.total*100+"%",backgroundColor:o.color})},null,4)])]))),128))])])):L("",!0),a.value==="render"?(p(),h("div",ht,[e("div",pt,[e("div",vt,[n[4]||(n[4]=e("h4",null,"帧率统计",-1)),e("div",ft,[e("canvas",{ref_key:"fpsChart",ref:c,width:"300",height:"150"},null,512)])]),e("div",yt,[n[5]||(n[5]=e("h4",null,"渲染时间",-1)),e("div",gt,[(p(!0),h(C,null,x(K.value,o=>(p(),h("div",{class:"time-item",key:o.name},[e("span",_t,u(o.name),1),e("span",wt,u(o.value.toFixed(2))+"ms",1),e("div",bt,[e("div",{class:"time-fill",style:q({width:o.value/X.value*100+"%"})},null,4)])]))),128))])])])])):L("",!0),a.value==="network"?(p(),h("div",kt,[e("div",St,[e("div",Mt,[e("div",$t,[n[6]||(n[6]=e("span",{class:"stat-label"},"总请求",-1)),e("span",zt,u(M.totalRequests),1)]),e("div",Ct,[n[7]||(n[7]=e("span",{class:"stat-label"},"成功率",-1)),e("span",xt,u(M.successRate.toFixed(1))+"%",1)]),e("div",Tt,[n[8]||(n[8]=e("span",{class:"stat-label"},"平均延迟",-1)),e("span",Et,u(M.averageLatency.toFixed(0))+"ms",1)]),e("div",Ot,[n[9]||(n[9]=e("span",{class:"stat-label"},"数据传输",-1)),e("span",Pt,u(j(M.totalBytes)),1)])])]),e("div",Rt,[e("div",Lt,[n[10]||(n[10]=le('<div class="request-header" data-v-86e29d0f><span class="col-method" data-v-86e29d0f>方法</span><span class="col-url" data-v-86e29d0f>URL</span><span class="col-status" data-v-86e29d0f>状态</span><span class="col-time" data-v-86e29d0f>时间</span><span class="col-size" data-v-86e29d0f>大小</span></div>',1)),(p(!0),h(C,null,x(B.value,o=>(p(),h("div",{class:_(["request-item",{error:o.status>=400}]),key:o.id},[e("span",{class:_(["col-method",o.method.toLowerCase()])},u(o.method),3),e("span",{class:"col-url",title:o.url},u(De(o.url)),9,Ft),e("span",{class:_(["col-status",Be(o.status)])},u(o.status),3),e("span",Dt,u(o.duration)+"ms",1),e("span",Bt,u(j(o.size)),1)],2))),128))])])])):L("",!0),a.value==="cache"?(p(),h("div",It,[e("div",Ut,[e("div",jt,[e("div",At,[n[12]||(n[12]=e("div",{class:"stat-title"},"命中率",-1)),e("div",Ht,u(k.hitRate.toFixed(1))+"%",1),e("div",Nt,[e("div",Jt,[(p(),h("svg",Wt,[n[11]||(n[11]=e("circle",{cx:"30",cy:"30",r:"25",fill:"none",stroke:"#e5e7eb","stroke-width":"4"},null,-1)),e("circle",{cx:"30",cy:"30",r:"25",fill:"none",stroke:"#10b981","stroke-width":"4","stroke-dasharray":W,"stroke-dashoffset":W-k.hitRate/100*W,transform:"rotate(-90 30 30)"},null,8,qt)]))])])]),e("div",Kt,[n[13]||(n[13]=e("div",{class:"stat-title"},"缓存大小",-1)),e("div",Vt,u(j(k.totalSize)),1),e("div",Gt,u(k.totalEntries)+" 条目",1)]),e("div",Zt,[n[14]||(n[14]=e("div",{class:"stat-title"},"内存使用",-1)),e("div",Qt,u((k.memoryUsage*100).toFixed(1))+"%",1),e("div",Xt,u(j(k.memoryUsed)),1)])])]),e("div",Yt,[(p(!0),h(C,null,x(V.value,o=>(p(),h("div",{class:"layer-item",key:o.name},[e("div",es,[e("span",ts,u(o.name),1),e("span",ss,u(o.size)+" 项",1)]),e("div",os,[e("div",{class:"layer-fill",style:q({width:o.size/Y.value*100+"%",backgroundColor:o.color})},null,4)]),e("div",is,[e("span",null,"命中: "+u(o.hits),1),e("span",null,"未命中: "+u(o.misses),1),e("span",null,"驱逐: "+u(o.evictions),1)])]))),128))])])):L("",!0),a.value==="errors"?(p(),h("div",ns,[e("div",as,[e("div",rs,[e("div",cs,[e("span",ls,u(D.totalErrors),1),n[15]||(n[15]=e("span",{class:"count-label"},"总错误数",-1))]),e("div",ds,[e("span",us,u(D.errorRate.toFixed(2))+"%",1),n[16]||(n[16]=e("span",{class:"rate-label"},"错误率",-1))])])]),e("div",ms,[e("div",hs,[de(e("select",{"onUpdate:modelValue":n[0]||(n[0]=o=>l.value=o),class:"filter-select"},n[17]||(n[17]=[le('<option value="all" data-v-86e29d0f>所有错误</option><option value="javascript" data-v-86e29d0f>JavaScript 错误</option><option value="network" data-v-86e29d0f>网络错误</option><option value="render" data-v-86e29d0f>渲染错误</option><option value="api" data-v-86e29d0f>API 错误</option>',5)]),512),[[ue,l.value]]),de(e("select",{"onUpdate:modelValue":n[1]||(n[1]=o=>f.value=o),class:"sort-select"},n[18]||(n[18]=[e("option",{value:"time"},"按时间排序",-1),e("option",{value:"frequency"},"按频率排序",-1),e("option",{value:"severity"},"按严重程度排序",-1)]),512),[[ue,f.value]])]),e("div",ps,[(p(!0),h(C,null,x(ee.value,o=>(p(),h("div",{class:_(["error-item",o.severity]),key:o.id},[e("div",vs,[e("span",fs,u(o.type),1),e("span",ys,u(Pe(o.timestamp)),1),o.count>1?(p(),h("span",gs,u(o.count)+"x ",1)):L("",!0)]),e("div",_s,u(o.message),1),o.stack&&z.value?(p(),h("div",ws,[e("pre",null,u(o.stack),1)])):L("",!0),e("div",bs,[e("button",{onClick:y=>xe(o.id)},u(z.value?"隐藏":"显示")+"详情 ",9,ks),e("button",{onClick:y=>Te(o.id)},"忽略",8,Ss),e("button",{onClick:y=>Ee(o)},"报告",8,Ms)])],2))),128))])])])):L("",!0)])]),$.value.length>0?(p(),h("div",$s,[n[19]||(n[19]=e("h4",null,"性能优化建议",-1)),e("div",zs,[(p(!0),h(C,null,x($.value,o=>(p(),h("div",{class:_(["suggestion-item",o.priority]),key:o.id},[e("div",Cs,[e("i",{class:_(Ie(o.type))},null,2)]),e("div",xs,[e("div",Ts,u(o.title),1),e("div",Es,u(o.description),1),e("div",Os," 预期提升: "+u(o.impact),1)]),e("div",Ps,[e("button",{onClick:y=>ze(o),class:"btn-apply"}," 应用 ",8,Rs),e("button",{onClick:y=>Ce(o.id),class:"btn-dismiss"}," 忽略 ",8,Ls)])],2))),128))])])):L("",!0)],2))}}),Is=ve(Bs,[["__scopeId","data-v-86e29d0f"]]),Us={maxSize:1e3,maxMemory:50*1024*1024,defaultTTL:3e5,cleanupInterval:6e4,compressionThreshold:1024,persistentStorage:!0,storagePrefix:"lowcode_cache_",evictionPolicy:"lru",enableCompression:!0,enableEncryption:!1},js=[{name:"memory",priority:1,maxSize:500,ttl:6e4,enabled:!0},{name:"session",priority:2,maxSize:200,ttl:3e5,enabled:!0},{name:"local",priority:3,maxSize:100,ttl:36e5,enabled:!0},{name:"indexed",priority:4,maxSize:50,ttl:864e5,enabled:!0}];class As{constructor(t={}){O(this,"config");O(this,"layers");O(this,"layerConfigs");O(this,"stats");O(this,"cleanupTimer",null);O(this,"compressionWorker",null);O(this,"encryptionKey",null);this.config={...Us,...t},this.layers=new Map,this.layerConfigs=new Map,this.stats={hits:0,misses:0,sets:0,deletes:0,evictions:0,totalSize:0,totalMemory:0,hitRate:0,memoryUsage:0},this.initializeLayers(),this.startCleanupTimer(),this.initializeWorkers()}initializeLayers(){for(const t of js)t.enabled&&(this.layers.set(t.name,new Map),this.layerConfigs.set(t.name,t))}startCleanupTimer(){this.cleanupTimer&&clearInterval(this.cleanupTimer),this.cleanupTimer=window.setInterval(()=>{this.cleanup()},this.config.cleanupInterval)}async initializeWorkers(){if(this.config.enableCompression&&window.Worker)try{const t=`
          self.onmessage = function(e) {
            const { action, data, id } = e.data;
            
            if (action === 'compress') {
              try {
                const compressed = JSON.stringify(data);
                self.postMessage({ id, result: compressed, error: null });
              } catch (error) {
                self.postMessage({ id, result: null, error: error.message });
              }
            } else if (action === 'decompress') {
              try {
                const decompressed = JSON.parse(data);
                self.postMessage({ id, result: decompressed, error: null });
              } catch (error) {
                self.postMessage({ id, result: null, error: error.message });
              }
            }
          };
        `,i=new Blob([t],{type:"application/javascript"});this.compressionWorker=new Worker(URL.createObjectURL(i))}catch(t){console.warn("Failed to initialize compression worker:",t)}if(this.config.enableEncryption&&window.crypto&&window.crypto.subtle)try{this.encryptionKey=await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}catch(t){console.warn("Failed to generate encryption key:",t)}}async get(t,i){const r=i?[i]:Array.from(this.layerConfigs.keys()).sort((d,a)=>this.layerConfigs.get(d).priority-this.layerConfigs.get(a).priority);for(const d of r){const a=this.layers.get(d);if(!a)continue;const l=a.get(t);if(!l)continue;if(this.isExpired(l)){a.delete(t),this.stats.evictions++;continue}l.accessCount++,l.lastAccessed=Date.now(),this.stats.hits++;let f=l.value;return this.config.enableCompression&&l.size>this.config.compressionThreshold&&(f=await this.decompress(f)),this.config.enableEncryption&&(f=await this.decrypt(f)),d!==r[0]&&await this.promoteToHigherLayer(t,l,r[0]),this.updateStats(),f}return this.stats.misses++,this.updateStats(),null}async set(t,i,r={}){const d=r.ttl||this.config.defaultTTL,a=r.layer||"memory",l=r.tags||[],f=r.metadata||{},z=this.layers.get(a);if(!z)throw new Error(`Cache layer '${a}' not found`);const w=this.calculateSize(i);let g=i;this.config.enableEncryption&&(g=await this.encrypt(g)),this.config.enableCompression&&w>this.config.compressionThreshold&&(g=await this.compress(g));const M={key:t,value:g,timestamp:Date.now(),ttl:d,size:w,accessCount:0,lastAccessed:Date.now(),tags:l,metadata:f};await this.ensureCapacity(a,w),z.set(t,M),this.stats.sets++,this.stats.totalSize++,this.stats.totalMemory+=w,this.config.persistentStorage&&(a==="local"||a==="indexed")&&await this.persistEntry(a,t,M),this.updateStats()}async delete(t,i){let r=!1;const d=i?[i]:Array.from(this.layers.keys());for(const a of d){const l=this.layers.get(a);if(!l)continue;const f=l.get(t);f&&(l.delete(t),this.stats.deletes++,this.stats.totalSize--,this.stats.totalMemory-=f.size,r=!0,this.config.persistentStorage&&(a==="local"||a==="indexed")&&await this.removePersistentEntry(a,t))}return r&&this.updateStats(),r}async clear(t){const i=t?[t]:Array.from(this.layers.keys());for(const r of i){const d=this.layers.get(r);if(!d)continue;const a=d.size,l=Array.from(d.values()).reduce((f,z)=>f+z.size,0);d.clear(),this.stats.totalSize-=a,this.stats.totalMemory-=l,this.config.persistentStorage&&(r==="local"||r==="indexed")&&await this.clearPersistentStorage(r)}this.updateStats()}has(t,i){const r=i?[i]:Array.from(this.layers.keys());for(const d of r){const a=this.layers.get(d);if(!a)continue;const l=a.get(t);if(l&&!this.isExpired(l))return!0}return!1}size(t){var i;return t?((i=this.layers.get(t))==null?void 0:i.size)||0:Array.from(this.layers.values()).reduce((r,d)=>r+d.size,0)}keys(t){const i=[],r=t?[t]:Array.from(this.layers.keys());for(const d of r){const a=this.layers.get(d);a&&i.push(...Array.from(a.keys()))}return[...new Set(i)]}async deleteByTag(t){let i=0;for(const[r,d]of this.layers){const a=[];for(const[l,f]of d)f.tags.includes(t)&&a.push(l);for(const l of a)await this.delete(l,r),i++}return i}getStats(){return{...this.stats}}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t},t.cleanupInterval&&this.startCleanupTimer()}cleanup(){let t=0;for(const[i,r]of this.layers){const d=[];for(const[a,l]of r)this.isExpired(l)&&d.push(a);for(const a of d){const l=r.get(a);r.delete(a),this.stats.evictions++,this.stats.totalSize--,this.stats.totalMemory-=l.size,t++}}t>0&&this.updateStats()}isExpired(t){return Date.now()-t.timestamp>t.ttl}async ensureCapacity(t,i){const r=this.layers.get(t),d=this.layerConfigs.get(t);r.size>=d.maxSize&&await this.evictEntries(t,1);const a=Array.from(r.values()).reduce((l,f)=>l+f.size,0);if(a+i>this.config.maxMemory){const l=a+i-this.config.maxMemory;await this.evictByMemory(t,l)}}async evictEntries(t,i){const r=this.layers.get(t),d=Array.from(r.entries());let a=[];switch(this.config.evictionPolicy){case"lru":a=d.sort(([,l],[,f])=>l.lastAccessed-f.lastAccessed).slice(0,i);break;case"lfu":a=d.sort(([,l],[,f])=>l.accessCount-f.accessCount).slice(0,i);break;case"fifo":a=d.sort(([,l],[,f])=>l.timestamp-f.timestamp).slice(0,i);break;case"ttl":a=d.sort(([,l],[,f])=>l.timestamp+l.ttl-(f.timestamp+f.ttl)).slice(0,i);break}for(const[l]of a)await this.delete(l,t)}async evictByMemory(t,i){const r=this.layers.get(t),d=Array.from(r.entries()).sort(([,l],[,f])=>l.lastAccessed-f.lastAccessed);let a=0;for(const[l,f]of d){if(a>=i)break;await this.delete(l,t),a+=f.size}}async promoteToHigherLayer(t,i,r){await this.set(t,i.value,{ttl:i.ttl-(Date.now()-i.timestamp),layer:r,tags:i.tags,metadata:i.metadata})}calculateSize(t){try{return new Blob([JSON.stringify(t)]).size}catch{return JSON.stringify(t).length*2}}async compress(t){return this.compressionWorker?new Promise((i,r)=>{const d=Math.random().toString(36).substr(2,9),a=l=>{l.data.id===d&&(this.compressionWorker.removeEventListener("message",a),l.data.error?r(new Error(l.data.error)):i(l.data.result))};this.compressionWorker.addEventListener("message",a),this.compressionWorker.postMessage({action:"compress",data:t,id:d})}):t}async decompress(t){return this.compressionWorker?new Promise((i,r)=>{const d=Math.random().toString(36).substr(2,9),a=l=>{l.data.id===d&&(this.compressionWorker.removeEventListener("message",a),l.data.error?r(new Error(l.data.error)):i(l.data.result))};this.compressionWorker.addEventListener("message",a),this.compressionWorker.postMessage({action:"decompress",data:t,id:d})}):t}async encrypt(t){if(!this.encryptionKey||!window.crypto.subtle)return t;try{const i=JSON.stringify(t),d=new TextEncoder().encode(i),a=window.crypto.getRandomValues(new Uint8Array(12)),l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},this.encryptionKey,d);return{encrypted:Array.from(new Uint8Array(l)),iv:Array.from(a)}}catch(i){return console.warn("Encryption failed:",i),t}}async decrypt(t){if(!this.encryptionKey||!window.crypto.subtle||!t.encrypted)return t;try{const i=new Uint8Array(t.encrypted),r=new Uint8Array(t.iv),d=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},this.encryptionKey,i),l=new TextDecoder().decode(d);return JSON.parse(l)}catch(i){return console.warn("Decryption failed:",i),t}}async persistEntry(t,i,r){const d=`${this.config.storagePrefix}${t}_${i}`;try{if(t==="local")localStorage.setItem(d,JSON.stringify(r));else if(t==="indexed"&&window.indexedDB){const a=indexedDB.open("lowcode_cache",1);a.onupgradeneeded=()=>{const l=a.result;l.objectStoreNames.contains("cache")||l.createObjectStore("cache",{keyPath:"key"})},a.onsuccess=()=>{a.result.transaction(["cache"],"readwrite").objectStore("cache").put({key:d,...r})}}}catch(a){console.warn("Failed to persist cache entry:",a)}}async removePersistentEntry(t,i){const r=`${this.config.storagePrefix}${t}_${i}`;try{if(t==="local")localStorage.removeItem(r);else if(t==="indexed"&&window.indexedDB){const d=indexedDB.open("lowcode_cache",1);d.onsuccess=()=>{d.result.transaction(["cache"],"readwrite").objectStore("cache").delete(r)}}}catch(d){console.warn("Failed to remove persistent cache entry:",d)}}async clearPersistentStorage(t){try{if(t==="local")Object.keys(localStorage).filter(r=>r.startsWith(`${this.config.storagePrefix}${t}_`)).forEach(r=>localStorage.removeItem(r));else if(t==="indexed"&&window.indexedDB){const i=indexedDB.open("lowcode_cache",1);i.onsuccess=()=>{i.result.transaction(["cache"],"readwrite").objectStore("cache").clear()}}}catch(i){console.warn("Failed to clear persistent storage:",i)}}updateStats(){const t=this.stats.hits+this.stats.misses;this.stats.hitRate=t>0?this.stats.hits/t:0,this.stats.memoryUsage=this.stats.totalMemory/this.config.maxMemory}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.compressionWorker&&(this.compressionWorker.terminate(),this.compressionWorker=null),this.layers.clear(),this.layerConfigs.clear()}}function Hs(T){return new As(T)}Hs();const Ns={virtualScroll:{enabled:!0,itemHeight:50,overscan:5,threshold:100},lazyLoading:{enabled:!0,rootMargin:"50px",threshold:.1,delay:100},caching:{enabled:!0,maxSize:1e3,maxMemory:50*1024*1024,defaultTTL:3e5},monitoring:{enabled:!0,updateInterval:1e3,maxHistorySize:100,autoStart:!0}};class Js{constructor(t={}){O(this,"config");O(this,"metrics");O(this,"optimizations");O(this,"observers");O(this,"timers");O(this,"cache");this.config={...Ns,...t},this.metrics=this.initializeMetrics(),this.optimizations=[],this.observers=new Map,this.timers=new Map,this.cache=createCacheManager(this.config.caching),this.initialize()}initialize(){this.config.monitoring.enabled&&this.startMonitoring(),this.registerPerformanceObservers(),this.startOptimizationCheck()}initializeMetrics(){return{fps:60,memory:{used:0,total:0,available:0},network:{requests:0,latency:0,bandwidth:0},cache:{hitRate:0,size:0,entries:0},errors:{count:0,rate:0}}}startMonitoring(){const t=window.setInterval(()=>{this.updateMetrics(),this.checkOptimizations()},this.config.monitoring.updateInterval);this.timers.set("monitoring",t)}stopMonitoring(){const t=this.timers.get("monitoring");t&&(clearInterval(t),this.timers.delete("monitoring")),this.observers.forEach(i=>i.disconnect()),this.observers.clear()}registerPerformanceObservers(){if(!window.PerformanceObserver)return;const t=new PerformanceObserver(a=>{const l=a.getEntries();this.processNavigationEntries(l)});try{t.observe({entryTypes:["navigation"]}),this.observers.set("navigation",t)}catch(a){console.warn("Failed to register navigation observer:",a)}const i=new PerformanceObserver(a=>{const l=a.getEntries();this.processResourceEntries(l)});try{i.observe({entryTypes:["resource"]}),this.observers.set("resource",i)}catch(a){console.warn("Failed to register resource observer:",a)}const r=new PerformanceObserver(a=>{const l=a.getEntries();this.processPaintEntries(l)});try{r.observe({entryTypes:["paint"]}),this.observers.set("paint",r)}catch(a){console.warn("Failed to register paint observer:",a)}const d=new PerformanceObserver(a=>{const l=a.getEntries();this.processLongTaskEntries(l)});try{d.observe({entryTypes:["longtask"]}),this.observers.set("longtask",d)}catch(a){console.warn("Failed to register longtask observer:",a)}}processNavigationEntries(t){t.forEach(i=>{const r=i;this.metrics.network.latency=r.responseEnd-r.requestStart,r.loadEventEnd-r.navigationStart>3e3&&this.addOptimization({id:"slow-page-load",type:"network",priority:"high",title:"页面加载缓慢",description:"页面加载时间超过3秒，建议优化资源加载",impact:"减少加载时间50%"})})}processResourceEntries(t){t.forEach(i=>{const r=i;this.metrics.network.requests++,r.transferSize>1024*1024&&this.addOptimization({id:`large-resource-${Date.now()}`,type:"network",priority:"medium",title:"大资源文件",description:`资源 ${r.name} 大小超过1MB，建议压缩或分割`,impact:"减少传输时间30%"}),r.duration>2e3&&this.addOptimization({id:`slow-resource-${Date.now()}`,type:"network",priority:"medium",title:"资源加载缓慢",description:`资源 ${r.name} 加载时间超过2秒`,impact:"提升加载速度40%"})})}processPaintEntries(t){t.forEach(i=>{i.name==="first-contentful-paint"&&i.startTime>2e3&&this.addOptimization({id:"slow-fcp",type:"render",priority:"high",title:"首次内容绘制缓慢",description:"FCP 时间超过2秒，建议优化关键渲染路径",impact:"提升用户体验50%"}),i.name==="largest-contentful-paint"&&i.startTime>2500&&this.addOptimization({id:"slow-lcp",type:"render",priority:"high",title:"最大内容绘制缓慢",description:"LCP 时间超过2.5秒，建议优化主要内容加载",impact:"提升页面性能60%"})})}processLongTaskEntries(t){t.forEach(i=>{i.duration>50&&this.addOptimization({id:`long-task-${Date.now()}`,type:"render",priority:"medium",title:"长任务阻塞",description:`检测到 ${i.duration.toFixed(0)}ms 的长任务，可能影响用户交互`,impact:"提升响应性30%"})})}updateMetrics(){performance.memory&&(this.metrics.memory.used=performance.memory.usedJSHeapSize,this.metrics.memory.total=performance.memory.totalJSHeapSize,this.metrics.memory.available=performance.memory.jsHeapSizeLimit-performance.memory.usedJSHeapSize),this.updateFPS();const t=this.cache.getStats();this.metrics.cache.hitRate=t.hitRate,this.metrics.cache.size=t.totalMemory,this.metrics.cache.entries=t.totalSize}updateFPS(){const t=performance.now(),i=this.lastFPSTime||t,r=t-i;r>0&&(this.metrics.fps=Math.min(Math.round(1e3/r),60)),this.lastFPSTime=t}startOptimizationCheck(){const t=window.setInterval(()=>{this.checkOptimizations()},3e4);this.timers.set("optimization",t)}checkOptimizations(){this.metrics.memory.total>0&&this.metrics.memory.used/this.metrics.memory.total>.8&&this.addOptimization({id:"high-memory-usage",type:"memory",priority:"high",title:"内存使用过高",description:"内存使用超过80%，建议清理不必要的对象引用",impact:"减少内存使用30%",action:()=>{window.gc&&window.gc()}}),this.metrics.fps<30&&this.addOptimization({id:"low-fps",type:"render",priority:"high",title:"FPS 过低",description:"帧率低于30fps，建议优化渲染性能",impact:"提升帧率至60fps"}),this.metrics.cache.hitRate<.7&&this.addOptimization({id:"low-cache-hit-rate",type:"cache",priority:"medium",title:"缓存命中率低",description:"缓存命中率低于70%，建议优化缓存策略",impact:"提升响应速度40%"}),this.metrics.errors.rate>.05&&this.addOptimization({id:"high-error-rate",type:"network",priority:"critical",title:"错误率过高",description:"错误率超过5%，需要立即处理",impact:"提升稳定性80%"})}addOptimization(t){this.optimizations.some(r=>r.id===t.id)||(this.optimizations.push(t),this.optimizations.length>10&&this.optimizations.shift())}applyOptimization(t){const i=this.optimizations.find(r=>r.id===t);if(!i)return!1;if(i.action)try{i.action();const r=this.optimizations.findIndex(d=>d.id===t);return r>-1&&this.optimizations.splice(r,1),!0}catch(r){return console.error("Failed to apply optimization:",r),!1}return!1}dismissOptimization(t){const i=this.optimizations.findIndex(r=>r.id===t);return i>-1?(this.optimizations.splice(i,1),!0):!1}getMetrics(){return{...this.metrics}}getOptimizations(){return[...this.optimizations]}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t},t.caching&&this.cache.updateConfig(t.caching),t.monitoring&&(this.stopMonitoring(),this.config.monitoring.enabled&&this.startMonitoring())}exportReport(){return{timestamp:Date.now(),config:this.getConfig(),metrics:this.getMetrics(),optimizations:this.getOptimizations(),cacheStats:this.cache.getStats()}}destroy(){this.stopMonitoring(),this.timers.forEach(t=>clearInterval(t)),this.timers.clear(),this.cache.destroy(),this.optimizations=[]}}function Ws(T){return new Js(T)}Ws();const qs={class:"designer-test"},Ks={class:"test-header"},Vs={class:"test-controls"},Gs=["disabled"],Zs={class:"test-overview"},Qs={class:"test-stats"},Xs={class:"stat-item"},Ys={class:"stat-value"},eo={class:"stat-item"},to={class:"stat-value success"},so={class:"stat-item"},oo={class:"stat-value error"},io={class:"stat-item"},no={class:"stat-value"},ao={key:0,class:"test-progress"},ro={class:"progress-bar"},co={class:"progress-text"},lo={class:"test-modules"},uo={class:"module-grid"},mo={class:"module-header"},ho={class:"module-status"},po={class:"module-content"},vo={class:"test-items"},fo={class:"test-name"},yo={class:"test-result"},go=["disabled"],_o={class:"module-header"},wo={class:"module-status"},bo={class:"module-content"},ko={class:"test-items"},So={class:"test-name"},Mo={class:"test-result"},$o=["disabled"],zo={class:"module-header"},Co={class:"module-status"},xo={class:"module-content"},To={class:"test-items"},Eo={class:"test-name"},Oo={class:"test-result"},Po=["disabled"],Ro={class:"module-header"},Lo={class:"module-status"},Fo={class:"module-content"},Do={class:"test-items"},Bo={class:"test-name"},Io={class:"test-result"},Uo=["disabled"],jo={class:"module-header"},Ao={class:"module-status"},Ho={class:"module-content"},No={class:"test-items"},Jo={class:"test-name"},Wo={class:"test-result"},qo=["disabled"],Ko={class:"module-header"},Vo={class:"module-status"},Go={class:"module-content"},Zo={class:"test-items"},Qo={class:"test-name"},Xo={class:"test-result"},Yo=["disabled"],ei={key:0,class:"test-details"},ti={class:"results-list"},si={class:"result-header"},oi={class:"result-status"},ii={class:"result-time"},ni={class:"result-content"},ai={class:"result-description"},ri={key:0,class:"result-error"},ci={key:1,class:"result-details"},li={class:"performance-panel"},di=me({__name:"DesignerTest",setup(T){const t=b(!1),i=b(""),r=b(0),d=b([]),a=b([{id:"basic-components",name:"基础组件渲染",status:"pending",result:""},{id:"form-components",name:"表单组件功能",status:"pending",result:""},{id:"data-components",name:"数据展示组件",status:"pending",result:""},{id:"navigation-components",name:"导航组件",status:"pending",result:""},{id:"feedback-components",name:"反馈组件",status:"pending",result:""}]),l=b([{id:"grid-layout",name:"网格布局系统",status:"pending",result:""},{id:"responsive-layout",name:"响应式布局",status:"pending",result:""},{id:"drag-drop",name:"拖拽排序功能",status:"pending",result:""},{id:"layout-templates",name:"布局模板",status:"pending",result:""},{id:"layout-constraints",name:"布局约束",status:"pending",result:""}]),f=b([{id:"property-panel",name:"属性面板",status:"pending",result:""},{id:"style-editor",name:"样式编辑器",status:"pending",result:""},{id:"event-binding",name:"事件绑定",status:"pending",result:""},{id:"data-binding",name:"数据绑定",status:"pending",result:""},{id:"validation-rules",name:"验证规则",status:"pending",result:""}]),z=b([{id:"event-bus",name:"事件总线",status:"pending",result:""},{id:"data-source",name:"数据源管理",status:"pending",result:""},{id:"state-management",name:"状态管理",status:"pending",result:""},{id:"component-communication",name:"组件通信",status:"pending",result:""},{id:"data-synchronization",name:"数据同步",status:"pending",result:""}]),w=b([{id:"api-manager",name:"API管理器",status:"pending",result:""},{id:"dependency-injection",name:"依赖注入",status:"pending",result:""},{id:"config-management",name:"配置管理",status:"pending",result:""},{id:"service-integration",name:"服务集成",status:"pending",result:""},{id:"error-handling",name:"错误处理",status:"pending",result:""}]),g=b([{id:"virtual-scroll",name:"虚拟滚动",status:"pending",result:""},{id:"lazy-loading",name:"懒加载",status:"pending",result:""},{id:"cache-management",name:"缓存管理",status:"pending",result:""},{id:"performance-monitoring",name:"性能监控",status:"pending",result:""},{id:"memory-optimization",name:"内存优化",status:"pending",result:""}]),M=R(()=>a.value.length+l.value.length+f.value.length+z.value.length+w.value.length+g.value.length),k=R(()=>d.value.filter(v=>v.status==="passed").length),D=R(()=>d.value.filter(v=>v.status==="failed").length),B=R(()=>d.value.length===0?0:Math.round(k.value/d.value.length*100)),S=v=>{const c=J(v),m=c.some(I=>I.status==="running"),E=c.some(I=>I.status==="failed"),P=c.every(I=>I.status==="passed");return m?"running":E?"failed":P&&c.length>0?"passed":"pending"},$=v=>{const c=S(v);return{pending:"待测试",running:"测试中",passed:"通过",failed:"失败"}[c]},J=v=>{switch(v){case"components":return a.value;case"layout":return l.value;case"properties":return f.value;case"communication":return z.value;case"backend":return w.value;case"performance":return g.value;default:return[]}},Z=async()=>{if(t.value)return;t.value=!0,r.value=0,d.value=[];const v=["components","layout","properties","communication","backend","performance"];for(let c=0;c<v.length;c++)await F(v[c]),r.value=Math.round((c+1)/v.length*100);t.value=!1,i.value=""},F=async v=>{const c=J(v);for(const m of c){m.status="running",i.value=`${v} - ${m.name}`;const E=performance.now();try{await Q(v,m);const P=Math.round(performance.now()-E);m.status="passed",m.result="通过",d.value.push({id:m.id,module:v,name:m.name,status:"passed",duration:P,description:`${m.name} 测试通过`})}catch(P){const I=Math.round(performance.now()-E);m.status="failed",m.result="失败",d.value.push({id:m.id,module:v,name:m.name,status:"failed",duration:I,description:`${m.name} 测试失败`,error:P instanceof Error?P.message:String(P)})}await new Promise(P=>setTimeout(P,200))}},Q=async(v,c)=>{const m=Math.random()*1e3+500;if(await new Promise(E=>setTimeout(E,m)),Math.random()<.1)throw new Error(`模拟测试失败: ${c.name}`);switch(v){case"components":await K(c);break;case"layout":await X(c);break;case"properties":await V(c);break;case"communication":await Y(c);break;case"backend":await W(c);break;case"performance":await ee(c);break}},K=async v=>{console.log(`Testing component: ${v.name}`)},X=async v=>{console.log(`Testing layout: ${v.name}`)},V=async v=>{console.log(`Testing properties: ${v.name}`)},Y=async v=>{console.log(`Testing communication: ${v.name}`)},W=async v=>{console.log(`Testing backend: ${v.name}`)},ee=async v=>{console.log(`Testing performance: ${v.name}`)},te=()=>{d.value=[],[...a.value,...l.value,...f.value,...z.value,...w.value,...g.value].forEach(c=>{c.status="pending",c.result=""})},H=()=>{const v={timestamp:new Date().toISOString(),summary:{total:M.value,passed:k.value,failed:D.value,successRate:B.value},results:d.value},c=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),m=URL.createObjectURL(c),E=document.createElement("a");E.href=m,E.download=`designer-test-report-${Date.now()}.json`,E.click(),URL.revokeObjectURL(m)};return he(()=>{console.log("Designer test page mounted")}),pe(()=>{console.log("Designer test page unmounted")}),(v,c)=>(p(),h("div",qs,[e("div",Ks,[c[6]||(c[6]=e("h1",null,"可视化设计器测试页面",-1)),e("div",Vs,[e("button",{onClick:Z,disabled:t.value,class:"btn-primary"},u(t.value?"测试中...":"运行所有测试"),9,Gs),e("button",{onClick:te,class:"btn-secondary"},"清除结果"),e("button",{onClick:H,class:"btn-outline"},"导出结果")])]),e("div",Zs,[e("div",Qs,[e("div",Xs,[c[7]||(c[7]=e("span",{class:"stat-label"},"总测试数",-1)),e("span",Ys,u(M.value),1)]),e("div",eo,[c[8]||(c[8]=e("span",{class:"stat-label"},"通过",-1)),e("span",to,u(k.value),1)]),e("div",so,[c[9]||(c[9]=e("span",{class:"stat-label"},"失败",-1)),e("span",oo,u(D.value),1)]),e("div",io,[c[10]||(c[10]=e("span",{class:"stat-label"},"成功率",-1)),e("span",no,u(B.value)+"%",1)])]),t.value?(p(),h("div",ao,[e("div",ro,[e("div",{class:"progress-fill",style:q({width:`${r.value}%`})},null,4)]),e("span",co,u(i.value),1)])):L("",!0)]),e("div",lo,[e("div",uo,[e("div",{class:_(["test-module",S("components")])},[e("div",mo,[c[11]||(c[11]=e("h3",null,"组件库测试",-1)),e("span",ho,u($("components")),1)]),e("div",po,[c[12]||(c[12]=e("p",null,"测试基础组件、表单组件、数据展示组件等",-1)),e("div",vo,[(p(!0),h(C,null,x(a.value,m=>(p(),h("div",{key:m.id,class:_(["test-item",m.status])},[e("span",fo,u(m.name),1),e("span",yo,u(m.result),1)],2))),128))]),e("button",{onClick:c[0]||(c[0]=m=>F("components")),disabled:t.value,class:"btn-test"}," 运行测试 ",8,go)])],2),e("div",{class:_(["test-module",S("layout")])},[e("div",_o,[c[13]||(c[13]=e("h3",null,"布局系统测试",-1)),e("span",wo,u($("layout")),1)]),e("div",bo,[c[14]||(c[14]=e("p",null,"测试网格布局、响应式布局、拖拽排序等",-1)),e("div",ko,[(p(!0),h(C,null,x(l.value,m=>(p(),h("div",{key:m.id,class:_(["test-item",m.status])},[e("span",So,u(m.name),1),e("span",Mo,u(m.result),1)],2))),128))]),e("button",{onClick:c[1]||(c[1]=m=>F("layout")),disabled:t.value,class:"btn-test"}," 运行测试 ",8,$o)])],2),e("div",{class:_(["test-module",S("properties")])},[e("div",zo,[c[15]||(c[15]=e("h3",null,"属性编辑器测试",-1)),e("span",Co,u($("properties")),1)]),e("div",xo,[c[16]||(c[16]=e("p",null,"测试属性面板、样式编辑器、事件绑定等",-1)),e("div",To,[(p(!0),h(C,null,x(f.value,m=>(p(),h("div",{key:m.id,class:_(["test-item",m.status])},[e("span",Eo,u(m.name),1),e("span",Oo,u(m.result),1)],2))),128))]),e("button",{onClick:c[2]||(c[2]=m=>F("properties")),disabled:t.value,class:"btn-test"}," 运行测试 ",8,Po)])],2),e("div",{class:_(["test-module",S("communication")])},[e("div",Ro,[c[17]||(c[17]=e("h3",null,"组件通信测试",-1)),e("span",Lo,u($("communication")),1)]),e("div",Fo,[c[18]||(c[18]=e("p",null,"测试事件总线、数据源管理、状态管理等",-1)),e("div",Do,[(p(!0),h(C,null,x(z.value,m=>(p(),h("div",{key:m.id,class:_(["test-item",m.status])},[e("span",Bo,u(m.name),1),e("span",Io,u(m.result),1)],2))),128))]),e("button",{onClick:c[3]||(c[3]=m=>F("communication")),disabled:t.value,class:"btn-test"}," 运行测试 ",8,Uo)])],2),e("div",{class:_(["test-module",S("backend")])},[e("div",jo,[c[19]||(c[19]=e("h3",null,"后端集成测试",-1)),e("span",Ao,u($("backend")),1)]),e("div",Ho,[c[20]||(c[20]=e("p",null,"测试API管理、依赖注入、配置管理等",-1)),e("div",No,[(p(!0),h(C,null,x(w.value,m=>(p(),h("div",{key:m.id,class:_(["test-item",m.status])},[e("span",Jo,u(m.name),1),e("span",Wo,u(m.result),1)],2))),128))]),e("button",{onClick:c[4]||(c[4]=m=>F("backend")),disabled:t.value,class:"btn-test"}," 运行测试 ",8,qo)])],2),e("div",{class:_(["test-module",S("performance")])},[e("div",Ko,[c[21]||(c[21]=e("h3",null,"性能优化测试",-1)),e("span",Vo,u($("performance")),1)]),e("div",Go,[c[22]||(c[22]=e("p",null,"测试虚拟滚动、懒加载、缓存管理等",-1)),e("div",Zo,[(p(!0),h(C,null,x(g.value,m=>(p(),h("div",{key:m.id,class:_(["test-item",m.status])},[e("span",Qo,u(m.name),1),e("span",Xo,u(m.result),1)],2))),128))]),e("button",{onClick:c[5]||(c[5]=m=>F("performance")),disabled:t.value,class:"btn-test"}," 运行测试 ",8,Yo)])],2)])]),d.value.length>0?(p(),h("div",ei,[c[25]||(c[25]=e("h2",null,"详细测试结果",-1)),e("div",ti,[(p(!0),h(C,null,x(d.value,m=>(p(),h("div",{key:m.id,class:_(["result-item",m.status])},[e("div",si,[e("h4",null,u(m.module)+" - "+u(m.name),1),e("span",oi,u(m.status),1),e("span",ii,u(m.duration)+"ms",1)]),e("div",ni,[e("p",ai,u(m.description),1),m.error?(p(),h("div",ri,[c[23]||(c[23]=e("strong",null,"错误信息：",-1)),e("pre",null,u(m.error),1)])):L("",!0),m.details?(p(),h("div",ci,[c[24]||(c[24]=e("strong",null,"详细信息：",-1)),e("pre",null,u(JSON.stringify(m.details,null,2)),1)])):L("",!0)])],2))),128))])])):L("",!0),e("div",li,[c[26]||(c[26]=e("h2",null,"性能监控",-1)),Ne(Je(Is))])]))}}),vi=ve(di,[["__scopeId","data-v-339d7c51"]]);export{vi as default};
