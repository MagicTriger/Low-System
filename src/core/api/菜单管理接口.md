# 菜单管理接口文档

## 1. 概述

本文档描述了MES系统菜单管理模块的API接口规范，包括菜单查询、创建、更新、删除以及菜单树结构获取等操作。

## 2. 接口列表

| 接口名称 | 请求方法 | 请求路径 | 说明 |
|---------|---------|---------|------|
| [查询菜单列表](#41-查询菜单列表) | GET | `/api/permissions/menus/list` | 分页查询菜单列表 |
| [获取菜单树](#42-获取菜单树) | GET | `/api/permissions/menus/tree` | 获取菜单树结构 |
| [创建菜单](#43-创建菜单) | POST | `/api/permissions/menus/create` | 创建新菜单 |
| [更新菜单](#44-更新菜单) | PUT | `/api/permissions/menus/update` | 更新菜单信息 |
| [删除菜单](#45-删除菜单) | DELETE | `/api/permissions/menus/delete/{id}` | 删除指定菜单 |

## 3. 数据模型

### 3.1 MenuResponse (菜单信息响应)

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| id | int | 是 | 菜单ID |
| parentId | int | 否 | 父菜单ID，null表示根菜单 |
| menuCode | string | 是 | 菜单编码，唯一标识 |
| name | string | 是 | 菜单名称 |
| module | string | 是 | 业务模块 |
| nodeType | int | 是 | 节点类型：1=文件夹，2=页面，3=按钮 |
| nodeTypeText | string | 是 | 节点类型文本描述 |
| sortOrder | int | 是 | 排序序号 |
| url | string | 否 | 关联URL |
| icon | string | 否 | 图标 |
| path | string | 否 | 路径 |
| meta | string | 否 | 元数据 |
| createdAt | string | 是 | 创建时间 |

### 3.2 MenuCreateRequest (创建菜单请求)

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| parentId | int | 否 | 父菜单ID，null表示根菜单 |
| menuCode | string | 是 | 菜单编码，唯一标识 |
| name | string | 是 | 菜单名称 |
| module | string | 是 | 业务模块 |
| nodeType | int | 否 | 节点类型，默认为2（页面） |
| sortOrder | int | 否 | 排序序号，默认为0 |
| url | string | 否 | 关联URL |
| icon | string | 否 | 图标 |
| path | string | 否 | 路径 |
| meta | string | 否 | 元数据 |

### 3.3 MenuUpdateRequest (更新菜单请求)

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| id | int | 是 | 菜单ID |
| parentId | int | 否 | 父菜单ID，null表示根菜单 |
| menuCode | string | 是 | 菜单编码，唯一标识 |
| name | string | 是 | 菜单名称 |
| module | string | 是 | 业务模块 |
| nodeType | int | 是 | 节点类型：1=文件夹，2=页面，3=按钮 |
| sortOrder | int | 是 | 排序序号 |
| url | string | 否 | 关联URL |
| icon | string | 否 | 图标 |
| path | string | 否 | 路径 |
| meta | string | 否 | 元数据 |

### 3.4 MenuQueryRequest (菜单查询请求)

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| name | string | 否 | 菜单名称（模糊查询） |
| menuCode | string | 否 | 菜单编码（模糊查询） |
| module | string | 否 | 业务模块（模糊查询） |
| nodeType | int | 否 | 节点类型筛选 |
| parentId | int | 否 | 父菜单ID筛选 |
| icon | string | 否 | 图标筛选 |
| path | string | 否 | 路径筛选 |
| meta | string | 否 | 元数据筛选 |
| page | int | 否 | 页码，默认为1 |
| size | int | 否 | 每页大小，默认为10 |

### 3.5 MenuPageResult (菜单分页结果)

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| data | array[MenuResponse] | 是 | 菜单列表 |
| total | int | 是 | 总记录数 |
| page | int | 是 | 当前页码 |
| size | int | 是 | 每页大小 |
| totalPages | int | 是 | 总页数 |
| hasNext | boolean | 是 | 是否有下一页 |
| hasPrevious | boolean | 是 | 是否有上一页 |

### 3.6 MenuTreeNode (菜单树节点)

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| id | int | 是 | 菜单ID |
| parentId | int | 否 | 父菜单ID |
| menuCode | string | 是 | 菜单编码 |
| name | string | 是 | 菜单名称 |
| module | string | 是 | 业务模块 |
| nodeType | int | 是 | 节点类型 |
| nodeTypeText | string | 是 | 节点类型文本 |
| sortOrder | int | 是 | 排序序号 |
| url | string | 否 | 关联URL |
| icon | string | 否 | 图标 |
| path | string | 否 | 路径 |
| meta | string | 否 | 元数据 |
| createdAt | string | 是 | 创建时间 |
| children | array[MenuTreeNode] | 否 | 子菜单列表 |

## 4. 接口详情

### 4.1 查询菜单列表

#### 接口URL
```
GET /api/permissions/menus/list
```

#### 请求参数 (Query Parameters)
| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| name | string | 否 | 菜单名称（模糊查询） |
| menuCode | string | 否 | 菜单编码（模糊查询） |
| module | string | 否 | 业务模块（模糊查询） |
| nodeType | integer | 否 | 节点类型筛选 |
| parentId | integer | 否 | 父菜单ID筛选 |
| icon | string | 否 | 图标筛选 |
| path | string | 否 | 路径筛选 |
| meta | string | 否 | 元数据筛选 |
| page | integer | 否 | 页码，默认为1 |
| size | integer | 否 | 每页大小，默认为10 |

#### 请求示例
```bash
curl -H "Authorization: Bearer <access_token>" \
     -H "Content-Type: application/json" \
     "http://localhost:8080/api/permissions/menus/list?name=用户&page=1&size=10"
```

#### 成功响应示例
```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "data": [
      {
        "id": 1,
        "parentId": null,
        "menuCode": "user_management",
        "name": "用户管理",
        "module": "user",
        "nodeType": 2,
        "nodeTypeText": "页面",
        "sortOrder": 1,
        "url": "/user/management",
        "icon": "user",
        "path": "/user",
        "meta": "{\"keepAlive\": true}",
        "createdAt": "2023-01-01 12:00:00"
      }
    ],
    "total": 1,
    "page": 1,
    "size": 10,
    "totalPages": 1,
    "hasNext": false,
    "hasPrevious": false
  }
}
```

### 4.2 获取菜单树

#### 接口URL
```
GET /api/permissions/menus/tree
```

#### 请求示例
```bash
curl -H "Authorization: Bearer <access_token>" \
     -H "Content-Type: application/json" \
     "http://localhost:8080/api/permissions/menus/tree"
```

#### 成功响应示例
```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "parentId": null,
      "menuCode": "system",
      "name": "系统管理",
      "module": "system",
      "nodeType": 1,
      "nodeTypeText": "文件夹",
      "sortOrder": 1,
      "url": null,
      "icon": "system",
      "path": "/system",
      "meta": null,
      "createdAt": "2023-01-01 12:00:00",
      "children": [
        {
          "id": 2,
          "parentId": 1,
          "menuCode": "user_management",
          "name": "用户管理",
          "module": "user",
          "nodeType": 2,
          "nodeTypeText": "页面",
          "sortOrder": 1,
          "url": "/user/management",
          "icon": "user",
          "path": "/user",
          "meta": "{\"keepAlive\": true}",
          "createdAt": "2023-01-01 12:00:00",
          "children": []
        }
      ]
    }
  ]
}
```

### 4.3 创建菜单

#### 接口URL
```
POST /api/permissions/menus/create
```

#### 请求体 (JSON)
```json
{
  "parentId": 1,
  "menuCode": "user_management",
  "name": "用户管理",
  "module": "user",
  "nodeType": 2,
  "sortOrder": 1,
  "url": "/user/management",
  "icon": "user",
  "path": "/user",
  "meta": "{\"keepAlive\": true}"
}
```

#### 请求示例
```bash
curl -X POST \
     -H "Authorization: Bearer <access_token>" \
     -H "Content-Type: application/json" \
     -d '{
       "parentId": 1,
       "menuCode": "user_management",
       "name": "用户管理",
       "module": "user",
       "nodeType": 2,
       "sortOrder": 1,
       "url": "/user/management",
       "icon": "user",
       "path": "/user",
       "meta": "{\"keepAlive\": true}"
     }' \
     "http://localhost:8080/api/permissions/menus/create"
```

#### 成功响应示例
```json
{
  "success": true,
  "code": 200,
  "message": "菜单创建成功",
  "data": null
}
```

#### 失败响应示例
```json
{
  "success": false,
  "code": 400,
  "message": "菜单编码已存在",
  "data": null
}
```

### 4.4 更新菜单

#### 接口URL
```
PUT /api/permissions/menus/update
```

#### 请求体 (JSON)
```json
{
  "id": 1,
  "parentId": 1,
  "menuCode": "user_management",
  "name": "用户管理",
  "module": "user",
  "nodeType": 2,
  "sortOrder": 1,
  "url": "/user/management",
  "icon": "user",
  "path": "/user",
  "meta": "{\"keepAlive\": true}"
}
```

#### 请求示例
```bash
curl -X PUT \
     -H "Authorization: Bearer <access_token>" \
     -H "Content-Type: application/json" \
     -d '{
       "id": 1,
       "parentId": 1,
       "menuCode": "user_management",
       "name": "用户管理",
       "module": "user",
       "nodeType": 2,
       "sortOrder": 1,
       "url": "/user/management",
       "icon": "user",
       "path": "/user",
       "meta": "{\"keepAlive\": true}"
     }' \
     "http://localhost:8080/api/permissions/menus/update"
```

#### 成功响应示例
```json
{
  "success": true,
  "code": 200,
  "message": "菜单更新成功",
  "data": null
}
```

#### 失败响应示例
```json
{
  "success": false,
  "code": 404,
  "message": "菜单不存在",
  "data": null
}
```

### 4.5 删除菜单

#### 接口URL
```
DELETE /api/permissions/menus/delete/{id}
```

#### 路径参数
| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| id | integer | 是 | 菜单ID |

#### 请求示例
```bash
curl -X DELETE \
     -H "Authorization: Bearer <access_token>" \
     -H "Content-Type: application/json" \
     "http://localhost:8080/api/permissions/menus/delete/1"
```

#### 成功响应示例
```json
{
  "success": true,
  "code": 200,
  "message": "菜单删除成功",
  "data": null
}
```

#### 失败响应示例
```json
{
  "success": false,
  "code": 400,
  "message": "该菜单下存在子菜单，无法删除",
  "data": null
}
```

## 5. 错误码说明

| 错误码 | 说明 |
|-------|------|
| 200 | 操作成功 |
| 400 | 请求参数错误 |
| 401 | 未授权访问 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 409 | 资源冲突（如菜单编码重复） |
| 500 | 服务器内部错误 |

## 6. 节点类型说明

| 值 | 类型 | 说明 |
|----|------|------|
| 1 | 文件夹 | 用于组织菜单结构，不可点击 |
| 2 | 页面 | 可点击的菜单项，对应具体功能页面 |
| 3 | 按钮 | 页面内的操作按钮权限 |

## 7. 注意事项

1. **权限验证**: 所有接口都需要在请求头中携带有效的访问令牌
2. **菜单编码唯一性**: 菜单编码在系统中必须唯一
3. **级联删除**: 删除菜单时会级联删除其所有子菜单，请谨慎操作
4. **排序规则**: sortOrder值越小，菜单显示越靠前
5. **父子关系**: 创建子菜单时，父菜单必须存在
6. **节点类型限制**: 只有文件夹类型的菜单才能作为其他菜单的父菜单

## 8. 使用示例

### 8.1 创建菜单层级结构

1. 首先创建根菜单（文件夹类型）：
```json
{
  "parentId": null,
  "menuCode": "system",
  "name": "系统管理",
  "module": "system",
  "nodeType": 1,
  "sortOrder": 1,
  "icon": "system"
}
```

2. 然后创建子菜单（页面类型）：
```json
{
  "parentId": 1,
  "menuCode": "user_management",
  "name": "用户管理",
  "module": "user",
  "nodeType": 2,
  "sortOrder": 1,
  "url": "/user/management",
  "icon": "user",
  "path": "/user"
}
```

### 8.2 查询特定模块的菜单
```bash
curl -H "Authorization: Bearer <access_token>" \
     "http://localhost:8080/api/permissions/menus/list?module=user&nodeType=2"
```

### 8.3 批量操作建议

对于批量创建菜单的场景，建议：
1. 先创建所有父级菜单（文件夹类型）
2. 再创建子级菜单（页面类型）
3. 最后创建按钮权限（按钮类型）

### 8.4 菜单元数据使用示例

元数据字段可以存储JSON格式的配置信息：
```json
{
  "meta": "{\"keepAlive\": true, \"icon\": \"user\", \"hidden\": false, \"roles\": [\"admin\", \"user\"]}"
}
```

常用的元数据配置：
- `keepAlive`: 是否缓存页面
- `icon`: 菜单图标
- `hidden`: 是否隐藏菜单
- `roles`: 允许访问的角色列表
- `permissions`: 需要的权限列表
